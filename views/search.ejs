<!doctype html>
<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--  js   -->
    <script src="/javascripts/jquery.min.js"></script>

    <link href="/css/header.css" rel="stylesheet" type="text/css" />
    <link href="/css/search.css" rel="stylesheet" type="text/css" />

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/imgs/logo.ico" type="image/x-icon" />

    <title>ÊñáËóùÂØåÂøÉ</title>
</head>

<body>
    <!-- navbar -->
    <div id="header"></div>

    <!-- ÊñáÁ´†ÂàóË°®ÂçÄÂ°ä -->
    <section id="articleList">
        <div class="container-fluid article">

            <div class="row d-flex justify-content-center no-gutters">

                <div class="col-12 mb-3 col-lg-8 ">
                    <center style="margin:1em;">
                        <h3>ÊñáÁ´†ÊêúÂ∞ã</h3>
                        <hr class="highlight">
                    </center>

                    <!-- list -->
                    <% for(var i=0; i<items[0].length; i++) {%>
                    <div class="card shadow list "  style="cursor:pointer;">
                        <div class="card-body " onclick=" location.href='/article/<%= items[0][i].artiNum %>'">
                            <div class="poster">
                                <div class="name d-flex justify-content-between">
                                    <div style="white-space:nowrap !important">
                                        <a class="floorTag"><%= items[0][i].memName %></a>
                                        <a class="next"></a>
                                        <a class="dateTime">Êñº <%= items[0][i].artiDateTime %>Áôº‰Ωà</a>
                                    </div>
                                    <div class="ml-auto">
                                        <a class="itemClass"><%= items[0][i].artiClass %></a>
                                    </div>
                                </div>
                                <hr style="margin-top: 0.5em">
                            </div>
                            <div class="row seperate">
                                <div class="col-sm-9 articleContent">
                                    <h3 class="card-title "><%= items[0][i].artiHead %>
                                    </h3>
                                    <p class="card-text limitLine"><%- items[0][i].artiCont %>
                                    </p>

                                    <!-- tag -->
                                    <div class=" tagDiv col-lg-12 ">
                                        <% if(items[1] != undefined) { %>
                                        <% for(var j=0; j<items[1].length; j++) {%>
                                        <% if(items[0][i].artiNum == items[1][j].artiNum){ %>
                                        <button type=" button" class="btn  tag"><%= items[1][j].tagName %></button>
                                        <% } %>
                                        <% } %>
                                        <% } %>
                                    </div>
                                </div>
                                
                                <!-- imgs  -->
                                <div class="wrapperCard card-img-top col-lg-3"
                                    style="background-image: url( '<%= items[0][i].imgName %>'); ">
                                </div>
                            </div>
                        </div>

                        <!-- info -->
                        <div class="info">
                            <!-- ÊÑõÂøÉÊåâÈàï -->
                            <button type="button" id=<%= "LikeUnLogIn" + items[0][i].artiNum %> class="btn postInfo"
                                onclick="location.href='/login'"><i class="fab fa-gratipay"></i>
                                <a><%= items[0][i].likeCount %></a></button>
                            <button type="button" id=<%="addLike" + items[0][i].artiNum %> class="btn postInfo"
                                onclick=<%= "addLike(" + items[0][i].artiNum + ")" %>>
                                <i class="fab fa-gratipay"></i><a id=<%= "addLikeCount" + items[0][i].artiNum %>>
                                    <%= items[0][i].likeCount %> </a> </button>
                            <button type="button" id=<%= "delLike" + items[0][i].artiNum %> class="btn postInfo"
                                 onclick=<%= "delLike(" + items[0][i].artiNum + ")" %>>
                                <i class="fab fa-gratipay" style="color:#c93737"></i><a id=<%= "delLikeCount" + items[0][i].artiNum %>>
                                    <%= items[0][i].likeCount %></a></button>
                            <!-- Â¶ÇÊûúÊ≤íÁôªÂÖ• -->
                            <% if(items[5][0] == undefined) {%>              
                            <script type="text/javascript">
                                document.getElementById("LikeUnLogIn" + "<%= items[0][i].artiNum %>").style.display = "inline";
                                document.getElementById("addLike" + "<%= items[0][i].artiNum %>").style.display = "none";
                                document.getElementById("delLike" + "<%= items[0][i].artiNum %>").style.display = "none";
                            </script>
                            <!-- Â¶ÇÊûúÊúâÁôªÂÖ•-->
                            <% } else if(items[5][0] != undefined ) { %>
                                <!-- Âà§Êñ∑ÊòØÂê¶ÊúâÊåâÈÅéÊÑõÂøÉ -->
                                <% var isLike = false %>
                                <% if(items[2] != undefined ) { %>
                                    <%  for (var j = 0; j < items[2].length ; j++) { %>
                                        <!-- Â¶ÇÊûúÊúâÊåâÈÅéÊÑõÂøÉ -->
                                        <% if(items[0][i].artiNum == items[2][j].artiNum ) { %>
                                            <script type="text/javascript">                                  
                                                document.getElementById("delLike" + "<%= items[0][i].artiNum %>").style.display = "inline";
                                                document.getElementById("addLike" + "<%= items[0][i].artiNum %>").style.display = "none";
                                                document.getElementById("LikeUnLogIn" + "<%= items[0][i].artiNum %>").style.display = "none";
                                            </script>
                                            <% isLike = true %>
                                        <% } %>
                                    <% } %>
                                <% } %>
                                <!-- Â¶ÇÊûúÊ≤íÊåâÈÅéÊÑõÂøÉ -->
                                <% if(isLike == false ){ %>
                                    <script type="text/javascript">
                                        document.getElementById("addLike" + "<%= items[0][i].artiNum %>").style.display = "inline";
                                        document.getElementById("LikeUnLogIn" + "<%= items[0][i].artiNum %>").style.display = "none";
                                        document.getElementById("delLike" + "<%= items[0][i].artiNum %>").style.display = "none";
                                    </script>
                                <% } %>
                            <% } else { %>
                                <script type="text/javascript">
                                    document.getElementById("delLike" + "<%= items[0][i].artiNum %>").style.display = "none";
                                    document.getElementById("addLike" + "<%= items[0][i].artiNum %>").style.display = "none";
                                    document.getElementById("LikeUnLogIn" + "<%= items[0][i].artiNum %>").style.display = "none";
                                </script>
                            <% } %>
                            <!-- ÁïôË®ÄÊï∏ÈáèÊåâÈàï -->
                            <button type="button" class="btn postInfo"><i
                                    class="fas fa-comment-dots"></i><a><%= items[0][i].messCount %></a></button>
                            <!-- Êî∂ËóèÊåâÈàï -->
                            <button type="button" id=<%= "unLogIn" + items[0][i].artiNum %> class="btn postInfo"
                                display: inline" onclick="location.href='/login'">
                                <i class="far fa-bookmark"></i></button>
                            <button type="button" id=<%=  "addColle" + items[0][i].artiNum %> class="btn postInfo"
                                display: inline" onclick=<%= "addColle(" + items[0][i].artiNum + ")" %>>
                                <i class="far fa-bookmark"></i></button>
                            <button type="button" id=<%= "delColle" + items[0][i].artiNum %> class="btn postInfo"
                                style="display: inline" onclick=<%= "delColle(" + items[0][i].artiNum + ")" %>>
                                <i class="fas fa-bookmark"></i></button>
                            <!--  Êî∂ËóèÊåâÈàïÊéßÂà∂ -->
                            <!-- Â¶ÇÊûúÊ≤íÁôªÂÖ• -->
                            <% if(items[5][0] == undefined) {%>
                                <script type="text/javascript">
                                    document.getElementById("unLogIn" + "<%= items[0][i].artiNum %>").style.display = "inline";
                                    document.getElementById("addColle" + "<%= items[0][i].artiNum %>").style.display = "none";
                                    document.getElementById("delColle" + "<%= items[0][i].artiNum %>").style.display = "none";
                                </script>
                            <!-- Â¶ÇÊûúÊúâÁôªÂÖ• -->
                            <%  }else if(items[5][0] != undefined ) { %>
                                <% var isCollection = false %>
                                <% if(items[4] != undefined){ %>
                                    <% for(var j = 0 ; j < items[4].length ; j++) { %>
                                        <!-- Â¶ÇÊûúÊúâÊî∂Ëóè -->
                                        <% if (items[4][j].artiNum == items[0][i].artiNum){ %>
                                            <script type="text/javascript">
                                                document.getElementById("delColle" + "<%= items[0][i].artiNum %>").style.display = "inline";
                                                document.getElementById("addColle" + "<%= items[0][i].artiNum %>").style.display = "none";
                                                document.getElementById("unLogIn" + "<%= items[0][i].artiNum %>").style.display = "none";
                                            </script>
                                            <% isCollection = true %>
                                        <% } %>
                                    <% } %>
                                <% } %>
                                <!-- Â¶ÇÊûúÊ≤íÊî∂Ëóè -->
                                <% if( isCollection == false ){ %>
                                    <script type="text/javascript">
                                        document.getElementById("addColle" + "<%= items[0][i].artiNum %>").style.display = "inline";
                                        document.getElementById("unLogIn" + "<%= items[0][i].artiNum %>").style.display = "none";
                                        document.getElementById("delColle" + "<%= items[0][i].artiNum %>").style.display = "none";
                                    </script>
                                <% } %>                         
                            <!-- ÈåØË™§ÊµÅÁ®ã -->
                            <% }else {%>
                            <script type="text/javascript">
                                document.getElementById("delColle" + "<%= items[0][i].artiNum %>").style.display = "none";
                                document.getElementById("addColle" + "<%= items[0][i].artiNum %>").style.display = "none";
                                document.getElementById("unLogIn" + "<%= items[0][i].artiNum %>").style.display = "none";
                            </script>
                            <% } %>
                           
                        </div>
                        <!-- infoÁµêÊùü -->

                    </div>
                    <div class="w-100"></div>
                    <% } %>
                    <!-- listEnd -->

                </div>
            </div>

        </div>

        </div>


        </div>
    </section>
    <!-- ÊñáÁ´†ÂàóË°®ÂçÄÂ°äÁµêÊùü -->

    <!-- Portfolio Section -->
    <section id="portfolio">
        <center style="margin:1em;">
            <h3>Êé®Ëñ¶ÊêúÂ∞ã</h3>
            <hr class="highlight">

        </center>
        <div class="row d-flex no-gutters container-fluid justify-content-center align-items-center recommend">
            <!-- Êé®Ëñ¶ÈñãÂßã -->
            <% for(var i = 0 ; i<items[6].length ; i++){ %>
                <!-- Â¶ÇÊûúÊúâÊäìÂà∞ÂúñÁâá -->
            <% if(items[6][i].imgName) { %>
                <div class="wrapper col-12  col-lg-2"
                style="background-image:url('<%= items[6][i].imgName %>');">
            <!-- Â¶ÇÊûúÊ≤íÊäìÂà∞ÂçäÂºµÂúñÁâá -->
            <% } else { %>
                <div class="wrapper col-12  col-lg-2">
            <% } %>

                <a class="portfolio-box" href="/oneRecommend/<%= items[6][i].recomNum %>">
                    <div class="portfolio-box-caption">
                        <div class="project-category text-white-50">
                            <p><%= items[6][i].recomClass %> </p>
                        </div>
                        <div class="project-name">
                            <p class="title"><%= items[6][i].recomHead %></p>
                            <p class="content wrapText"><%= items[6][i].recomCont %></p>
                        </div>
                    </div>
                </a>
            </div>
            <% if( (i+1) % 4 == 0){ %>
            <div class="w-100"></div>
            <% } %>
            <% } %>
            <!-- Êé®Ëñ¶ÁµêÊùü -->
        </div>
    </section>

    <a href="#" id="gotop">
        <i class="fa fa-angle-up"></i>
    </a>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="/javascripts/active.js "></script>
    <script src="/javascripts/navbar.js"></script>
     <!-- Êî∂Ëóè ajax script -->
     <script>
            $('button').click(function() {
            if ($(this).children('.fa-gratipay').length > 0) {
                $(this).parent('div').find('.fa-gratipay').parent('button').attr('disabled', true)
                setTimeout(() => {
                    $('button').attr('disabled', false)
                }, 1000)
            }
        })
            //Êñ∞Â¢ûÊî∂Ëóè
            function addColle(artiNum) {
                collection(artiNum);
                $.ajax({
                    url: '/addCollection',
                    type: 'POST',
                    dataType: 'JSON',
                    data: { "likeType": "article", "artiNum": artiNum },
                    success: function (res) {
                    },
                    error: function (res) {
                        console.log("Â§±Êïó", JSON.stringify(res));
                    }
                });
            };
            //Âà™Èô§Êî∂Ëóè
            function delColle(artiNum) {
                cancelCollection(artiNum);
                $.ajax({
                    url: '/delCollection',
                    type: 'POST',
                    dataType: 'JSON',
                    data: { "likeType": "article", "artiNum": artiNum },
                    success: function (res) {
                    },
                    error: function (res) {
                        console.log("Â§±Êïó", JSON.stringify(res));
                    }
                });
            };
            //ÈªûÊî∂ËóèÂæåÊîπËÆäÂ±¨ÊÄß
            function collection(artiNum) {
                document.getElementById("delColle" + artiNum).style.display = "inline";
                document.getElementById("LikeUnLogIn" + artiNum).style.display = "none";
                document.getElementById("addColle" + artiNum).style.display = "none";
            }
            //ÂèñÊ∂àÊî∂ËóèÂæåÊîπËÆäÂ±¨ÊÄß
            function cancelCollection(artiNum) {
                document.getElementById("addColle" + artiNum).style.display = "inline";
                document.getElementById("LikeUnLogIn" + artiNum).style.display = "none";
                document.getElementById("delColle" + artiNum).style.display = "none";
            }
        </script>
        <!-- ÊÑõÂøÉ ajax script -->
        <script>
            //Êñ∞Â¢ûÊÑõÂøÉ
            function addLike(artiNum) {
                $.ajax({
                    url: '/addLike',
                    type: 'POST',
                    dataType: 'text',
                    data: { "likeType": "article", "artiNum": artiNum },
                    success: function (res) {
                        likeCount(artiNum);
                        like(artiNum);
                    },
                    error: function (res) {
                        console.log(res);
                    }
                });
            };
            //Âà™Èô§ÊÑõÂøÉ
            function delLike(artiNum) {
                $.ajax({
                    url: '/delLike',
                    type: 'POST',
                    dataType: 'text',
                    data: { "likeType": "article", "artiNum": artiNum },
                    success: function (res) {
                        likeCount(artiNum);
                        cancelLike(artiNum);
                    },
                    error: function (res) {
                        console.log("Âà™Èô§Â§±Êïó", JSON.stringify(res));
                    }
                });
            };
            //ÈªûÊÑõÂøÉÂæåÊîπËÆäÂ±¨ÊÄß
            function like(artiNum) {
                document.getElementById("delLike" + artiNum).style.display = "inline";
                document.getElementById("LikeUnLogIn" + artiNum).style.display = "none";
                document.getElementById("addLike" + artiNum).style.display = "none";
            }
            //ÂèñÊ∂àÊÑõÂøÉÂæåÊîπËÆäÂ±¨ÊÄß
            function cancelLike(artiNum) {
                document.getElementById("addLike" + artiNum).style.display = "inline";
                document.getElementById("LikeUnLogIn" + artiNum).style.display = "none";
                document.getElementById("delLike" + artiNum).style.display = "none";
            }
            function likeCount(artiNum) {
                $.ajax({
                    url: '/likeCount',
                    type: 'POST',
                    dataType: 'JSON',
                    data: { "likeType": "article", "artiNum": artiNum },
                    success: function (res) {
                        document.getElementById("addLikeCount" + artiNum).innerHTML = JSON.stringify(res);
                        document.getElementById("delLikeCount" + artiNum).innerHTML = JSON.stringify(res);
                    },
                    error: function (res) {
                        console.log(JSON.stringify(res));
                    }
                });
            }
        </script>
</body>

</html>